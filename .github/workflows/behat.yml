name: (M) Behat Tests
on:
  workflow_dispatch:
    inputs:
      database:
        description: 'Recent database dump to use (leave blank to use artifact)'
      sites:
        description: 'Specify which sites to test or leave the default to run all tests.'
        default: 'cci, asp, champ, coco, usrse, careers, gpc, ky, nect'
        required: true
      prnum:
        description: 'Pull request number â€” adds a comment to a pull request (nomally empty)'
permissions:
  contents: write
  actions: read
  pull-requests: write
jobs:
  cci:
    uses: necyberteam/reusable_actions/.github/workflows/behat.yml@main
    if: ${{ contains(github.event.inputs.sites, 'cci') }}
    secrets:
      site: "cci"
      database: ${{ github.event.inputs.database }}
      prnum: ${{ github.event.inputs.prnum }}
      gh_token: ${{ secrets.GH_TOKEN_REPO }}
      LANDO_ENV: ${{ secrets.LANDO_ENV }}
      SLACK_WEBHOOK: ${{ secrets.SLACK_WEBHOOK }}
      REPO: "${{ github.server_url }}/${{ github.repository }}"
  asp:
    uses: necyberteam/reusable_actions/.github/workflows/behat.yml@main
    if: ${{ contains(github.event.inputs.sites, 'asp') }}
    secrets:
      site: "asp"
      database: ${{ github.event.inputs.database }}
      prnum: ${{ github.event.inputs.prnum }}
      gh_token: ${{ secrets.GH_TOKEN_REPO }}
      LANDO_ENV: ${{ secrets.LANDO_ENV }}
      SLACK_WEBHOOK: ${{ secrets.SLACK_WEBHOOK }}
      REPO: "${{ github.server_url }}/${{ github.repository }}"
  champ:
    uses: necyberteam/reusable_actions/.github/workflows/behat.yml@main
    if: ${{ contains(github.event.inputs.sites, 'champ') }}
    secrets:
      site: "champ"
      database: ${{ github.event.inputs.database }}
      prnum: ${{ github.event.inputs.prnum }}
      gh_token: ${{ secrets.GH_TOKEN_REPO }}
      LANDO_ENV: ${{ secrets.LANDO_ENV }}
      SLACK_WEBHOOK: ${{ secrets.SLACK_WEBHOOK }}
      REPO: "${{ github.server_url }}/${{ github.repository }}"
  coco:
    uses: necyberteam/reusable_actions/.github/workflows/behat.yml@main
    if: ${{ contains(github.event.inputs.sites, 'coco') }}
    secrets:
      site: "coco"
      database: ${{ github.event.inputs.database }}
      prnum: ${{ github.event.inputs.prnum }}
      gh_token: ${{ secrets.GH_TOKEN_REPO }}
      LANDO_ENV: ${{ secrets.LANDO_ENV }}
      SLACK_WEBHOOK: ${{ secrets.SLACK_WEBHOOK }}
      REPO: "${{ github.server_url }}/${{ github.repository }}"
  usrse:
    uses: necyberteam/reusable_actions/.github/workflows/behat.yml@main
    if: ${{ contains(github.event.inputs.sites, 'usrse') }}
    secrets:
      site: "usrse"
      database: ${{ github.event.inputs.database }}
      prnum: ${{ github.event.inputs.prnum }}
      gh_token: ${{ secrets.GH_TOKEN_REPO }}
      LANDO_ENV: ${{ secrets.LANDO_ENV }}
      SLACK_WEBHOOK: ${{ secrets.SLACK_WEBHOOK }}
      REPO: "${{ github.server_url }}/${{ github.repository }}"
  careers:
    uses: necyberteam/reusable_actions/.github/workflows/behat.yml@main
    if: ${{ contains(github.event.inputs.sites, 'careers') }}
    secrets:
      site: "careers"
      database: ${{ github.event.inputs.database }}
      prnum: ${{ github.event.inputs.prnum }}
      gh_token: ${{ secrets.GH_TOKEN_REPO }}
      LANDO_ENV: ${{ secrets.LANDO_ENV }}
      SLACK_WEBHOOK: ${{ secrets.SLACK_WEBHOOK }}
      REPO: "${{ github.server_url }}/${{ github.repository }}"
  gpc:
    uses: necyberteam/reusable_actions/.github/workflows/behat.yml@main
    if: ${{ contains(github.event.inputs.sites, 'gpc') }}
    secrets:
      site: "gpc"
      database: ${{ github.event.inputs.database }}
      prnum: ${{ github.event.inputs.prnum }}
      gh_token: ${{ secrets.GH_TOKEN_REPO }}
      LANDO_ENV: ${{ secrets.LANDO_ENV }}
      SLACK_WEBHOOK: ${{ secrets.SLACK_WEBHOOK }}
      REPO: "${{ github.server_url }}/${{ github.repository }}"
  ky:
    uses: necyberteam/reusable_actions/.github/workflows/behat.yml@main
    if: ${{ contains(github.event.inputs.sites, 'ky') }}
    secrets:
      site: "ky"
      database: ${{ github.event.inputs.database }}
      prnum: ${{ github.event.inputs.prnum }}
      gh_token: ${{ secrets.GH_TOKEN_REPO }}
      LANDO_ENV: ${{ secrets.LANDO_ENV }}
      SLACK_WEBHOOK: ${{ secrets.SLACK_WEBHOOK }}
      REPO: "${{ github.server_url }}/${{ github.repository }}"
  nect:
    uses: necyberteam/reusable_actions/.github/workflows/behat.yml@main
    if: ${{ contains(github.event.inputs.sites, 'nect') }}
    secrets:
      site: "nect"
      database: ${{ github.event.inputs.database }}
      prnum: ${{ github.event.inputs.prnum }}
      gh_token: ${{ secrets.GH_TOKEN_REPO }}
      LANDO_ENV: ${{ secrets.LANDO_ENV }}
      SLACK_WEBHOOK: ${{ secrets.SLACK_WEBHOOK }}
      REPO: "${{ github.server_url }}/${{ github.repository }}"
