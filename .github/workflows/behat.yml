name: (M) Behat Tests

on:
  pull_request:
  workflow_dispatch:
    inputs:
      database:
        description: 'Recent database dump to use (leave blank to use artifact)'
      sites:
        description: 'Specify which sites to test or leave the default to run all tests.'
        default: 'cci, asp, champ, coco, usrse, careers, gpc, ky, nect'
        required: true
      prnum:
        description: 'Pull request number â€” adds a comment to a pull request (normally empty)'

permissions:
  contents: write
  actions: read
  pull-requests: write

jobs:
  behat-test:
    strategy:
      matrix:
        site: [ 'cci', 'asp', 'champ', 'coco', 'usrse', 'careers', 'gpc', 'ky', 'nect' ]
    runs-on: ubuntu-latest
    if: contains(github.event.inputs.sites, matrix.site) || github.event_name == 'pull_request'
    name: Behat Test - ${{ matrix.site }}
    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Behat Test
        uses: necyberteam/reusable_actions/.github/workflows/behat.yml@main
        with:
          slack_token: ${{ secrets.SLACK_TOKEN }}
          site: ${{ matrix.site }}
          database: ${{ github.event.inputs.database }}
          prnum: ${{ github.event.inputs.prnum }}
          gh_token: ${{ secrets.GH_TOKEN_REPO }}
          LANDO_ENV: ${{ secrets.LANDO_ENV }}
          SLACK_WEBHOOK: ${{ secrets.SLACK_WEBHOOK }}
          REPO: "${{ github.server_url }}/${{ github.repository }}"
