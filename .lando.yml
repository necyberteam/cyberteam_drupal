name: cyberteam
recipe: drupal9
env_file:
  - .env
config:
  webroot: web
  php: '8.1'
  database: mysql:5.7
  xdebug: debug
  config:
    php: ./.lando.php.ini
services:
  defaults:
    type: php:8.1
  database:
    portforward: 3300
  appserver:
    build_as_root:
      - apt-get update
      - apt-get install libxss1
      - echo "Run additional build commands here. Run lando rebuild after updating this file."
      - apt-get install -y ca-certificates curl gnupg
      - curl -fsSL https://deb.nodesource.com/gpgkey/nodesource-repo.gpg.key | gpg --dearmor -o /etc/apt/keyrings/nodesource.gpg
      - NODE_MAJOR=20
      - echo "deb [signed-by=/etc/apt/keyrings/nodesource.gpg] https://deb.nodesource.com/node_$NODE_MAJOR.x nodistro main" | tee /etc/apt/sources.list.d/nodesource.list
      - apt-get update && apt-get install nodejs -y
      - wget https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb
      - apt install -y ./google-chrome-stable_current_amd64.deb
      - rm google-chrome-stable_current_amd64.deb
tooling:
  blt:
    service: appserver
    cmd: /app/vendor/bin/blt
  npm:
    service: appserver
    cmd: /usr/bin/npm
  xdebug-on:
    service: appserver
    description: Enable xdebug for apache.
    cmd: "docker-php-ext-enable xdebug && /etc/init.d/apache2 reload"
    user: root
  xdebug-off:
    service: appserver
    description: Disable xdebug for apache.
    cmd: "rm /usr/local/etc/php/conf.d/docker-php-ext-xdebug.ini && /etc/init.d/apache2 reload"
    user: root
